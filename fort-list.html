<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="fort-li.html">
<link rel="import" href="fort-list-group.html">
<link rel="import" href="fort-list-shared-styles.html">
<link rel="import" href="../fort-theme/fort-theme-style.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<!--
A List

Example:

    <forti-list></fort-list>

@demo demo/index.html
-->

<dom-module id="fort-list"
            attributes="zebra border double-border border-group show-filter filter-label filter-icon autofocus no-results-content">
  <style>
    :host {
      display: block;
    }

    :host([zebra]) ::content fort-li[odd] {
      background-color: var(--theme-300-color, #F0F6FA);
    }

    :host([border]) ::content fort-li,
    :host([double-border]) ::content fort-li {
      border-bottom: 1px solid var(--fort-list-border-color);
    }

    :host([border]) ::content fort-li:last-child,
    :host([double-border]) ::content fort-li:last-child {
      border-bottom: 0;
    }

    :host([double-border]) ::content fort-li {
      border-top: 1px solid rgba(255, 255, 255, 0.12);
    }

    :host([double-border]) ::content fort-li:first-of-type {
      border-top: 0;
    }

    :host [prefix] {
      margin-left: 16px;
      margin-right: 32px;
    }

    :host([show-filter]) .filter {
      display: block;
    }

    :host .filter {
      display: none;
      @apply(--text-secondary);
      @apply(--paper-font-body2);
      @apply(--fort-list-filter);
    }

    :host .items {
      @apply(--fort-list-items-container);
    }

    :host .filter paper-input {
      height: 48px;
    }

    :host {
      --paper-input-container: {
        line-height: 48px;
        padding: 0;
      };
      --paper-input-container-label: {
        line-height: 48px;
      };
    }

    :host .no-results {
      display: none;
    }

    :host([no-results]) .no-results {
      display: block;
    }

    :host .filter-value {

    }
  </style>
  <template>
    <div class="filter">
      <paper-input autofocus$="[[autofocus]]" id="filterinput" label="{{filterLabel}}" no-label-float
                   on-keyup="filterList">
        <iron-icon icon="{{filterIcon}}" prefix></iron-icon>
      </paper-input>
    </div>
    <div class="items">
      <div class="no-results">
        <paper-icon-item>
          {{noResultsContent}}&nbsp;<q class="filter-value">{{filterValue}}</q>
        </paper-icon-item>
      </div>
      <content select="fort-li,fort-list-group"></content>
    </div>
  </template>

  <script>
    Polymer(
      {
        is:         'fort-list',
        properties: {
          filterValue:      '',
          showFilter:       {
            type:  Boolean,
            value: false
          },
          filterLabel:      {
            type:  String,
            value: "Filter"
          },
          filterIcon:       {
            type:  String,
            value: "icons:filter-list"
          },
          zebra:            {
            type:  Boolean,
            value: false
          },
          border:           {
            type:  Boolean,
            value: false
          },
          doubleBrder:      {
            type:  Boolean,
            value: false
          },
          noResults:        {
            type:               Boolean,
            value:              false,
            reflectToAttribute: true
          },
          noResultsContent: {
            type:  String,
            value: "No Results Matching "
          }
        },
        ready:      function ()
                    {
                      var self = this;
                      this.querySelectorAll('fort-li').forEach(
                        function (e)
                        {
                          e.addEventListener(
                            'filtered', function ()
                            {
                              self.noResults = self.querySelectorAll('fort-li[filtered]').length == 0;
                              self.stripe('fort-li[filtered]');
                            }
                          );
                        }
                      );
                      this.stripe('fort-li');
                    },
        stripe:     function (filter)
                    {
                      var i = 0;
                      this.querySelectorAll(filter).forEach(
                        function (e)
                        {
                          if(i % 2 == 0)
                          {
                            e.setAttribute('odd', true);
                          }
                          else
                          {
                            e.removeAttribute('odd');
                          }
                          i++;
                        }
                      );
                    },
        focus:      function ()
                    {
                      this.$.filterinput.focus();
                    },
        filterList: function (e)
                    {
                      this.filterValue = event.target.value;
                      this.fire('filter', {value: event.target.value});
                    }
      }
    );
  </script>
</dom-module>
